# BlogFlow 用户认证与权限管理系统

## 🔐 认证系统概览

BlogFlow 现在配备了完整的用户认证和权限管理系统，确保只有授权用户才能访问管理功能。

## 👤 用户角色

### 管理员 (Admin)
- **权限**: 完整的系统管理权限
- **可访问**: 管理面板、用户管理、文章管理、系统设置
- **演示账户**: 
  - 邮箱: `admin@blogflow.com`
  - 密码: `admin123`

### 作者 (Author)
- **权限**: 文章创建和编辑权限
- **可访问**: 个人文章管理
- **演示账户**:
  - 邮箱: `john@example.com`
  - 密码: `123456`

### 订阅者 (Subscriber)
- **权限**: 基础浏览权限
- **可访问**: 公共内容浏览
- **演示账户**:
  - 邮箱: `sarah@example.com`
  - 密码: `123456`

## 🚀 如何使用

### 1. 访问管理功能

#### 方法一：直接登录管理员账户
1. 点击右上角的"登录"按钮
2. 使用管理员演示账户登录：
   - 邮箱: `admin@blogflow.com`
   - 密码: `admin123`
3. 登录后会看到右上角的"管理"按钮

#### 方法二：普通用户注册
1. 点击"登录"按钮
2. 切换到"注册"标签
3. 填写注册信息创建新账户
4. 注册后默认为订阅者角色，无管理权限

### 2. 管理员界面访问

登录管理员账户后，可以通过以下方式访问管理功能：

**桌面端**:
- 点击Header右上角的"⚙️ 管理"下拉菜单
- 选择相应的管理功能：管理面板、文章管理、用户管理

**移动端**:
- 点击汉堡菜单 (☰) 
- 在"管理功能"区域选择相应功能

**直接访问**:
- 管理面板: `/admin`
- 文章管理: `/admin/posts`
- 用户管理: `/admin/users`

### 3. 权限控制机制

#### 界面权限
- 管理按钮只对管理员用户显示
- 普通用户和访客看不到管理入口

#### 页面权限
- 管理页面受中间件保护
- 未登录用户访问管理页面会跳转到登录页
- 已登录但无权限用户会收到403错误

#### 自动重定向
- 登录成功后自动跳转到目标页面
- 如果从管理页面跳转到登录，登录后会返回原页面

## 🔧 技术实现

### 认证组件
- `useAuth()` composable: 提供认证状态和操作
- `admin.ts` middleware: 保护管理页面
- `auth.client.ts` plugin: 初始化认证状态

### 权限检查
```javascript
const { isAuthenticated, canAccessAdmin, hasRole } = useAuth()

// 检查是否已登录
if (isAuthenticated.value) { /* ... */ }

// 检查管理员权限
if (canAccessAdmin.value) { /* ... */ }

// 检查特定角色
if (hasRole('admin')) { /* ... */ }
```

### 登录状态持久化
- 使用 localStorage 保存登录状态
- 支持"记住我"功能
- 页面刷新后自动恢复登录状态

## 📱 用户体验

### 登录界面
- 统一的登录/注册表单
- 演示账户信息展示
- 社交登录占位符（可扩展）
- 响应式设计适配移动端

### Header 状态显示
- 未登录: 显示"登录"按钮
- 已登录: 显示用户头像和下拉菜单
- 管理员: 额外显示"管理"按钮

### 安全特性
- 路由级别权限保护
- 自动登录状态检查
- 安全的密码验证
- 防止未授权访问

## 🎯 使用建议

### 开发测试
1. 使用管理员账户测试所有管理功能
2. 用普通账户测试权限限制
3. 测试未登录状态的页面访问

### 生产部署
1. 更改默认管理员密码
2. 配置真实的认证API
3. 启用HTTPS保护登录安全
4. 设置JWT过期时间

### 扩展建议
1. 集成OAuth第三方登录
2. 添加邮箱验证功能
3. 实现密码重置流程
4. 添加用户资料编辑

## 🔍 故障排除

### 常见问题

**Q: 登录后看不到管理按钮？**
A: 检查用户角色是否为 'admin'，只有管理员才能看到管理按钮。

**Q: 访问管理页面显示403错误？**
A: 确认已使用管理员账户登录，普通用户无法访问管理页面。

**Q: 刷新页面后登录状态丢失？**
A: 检查是否启用了"记住我"功能，或者浏览器是否禁用了localStorage。

**Q: 管理员账户登录失败？**
A: 确认使用正确的演示账户信息：
- 邮箱: admin@blogflow.com
- 密码: admin123

### 调试模式
在浏览器控制台中检查认证状态：
```javascript
// 获取当前用户信息
const { user, isAuthenticated, canAccessAdmin } = useAuth()
console.log('User:', user.value)
console.log('Is Authenticated:', isAuthenticated.value)
console.log('Can Access Admin:', canAccessAdmin.value)
```

---

**系统状态**: ✅ 完全就绪  
**权限控制**: 🔒 已启用  
**演示模式**: 🎭 可用  
**生产就绪**: 🚀 需配置真实API